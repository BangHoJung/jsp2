package controller;

import java.util.ArrayList;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.jsp.JspWriter;

import org.json.JSONArray;
import org.json.JSONObject;

import dto.QnaDTO;
import model.ModelAndView;
import service.BoardService;

public class NextQnaListController implements Controller {

	@Override
	public ModelAndView execute(HttpServletRequest request, HttpServletResponse response) {
		//1.조회할 페이지 번호 읽어옴
		String writer = request.getParameter("writer");
		int currPage = Integer.parseInt(request.getParameter("currPage"));
		String grade = request.getParameter("grade");
		//2.해당 페이지 목록을 읽어옴 - list
		System.out.println(writer+","+currPage+","+grade);
		ArrayList<QnaDTO> list = BoardService.getInstance().searchQnaList(writer, currPage+1, grade);
		//3.다음페이지 번호 / 다음페이지 없으면 0
		int nextPage = 0;
		if(list.size()>0) nextPage = currPage+1;
		//4. JSON으로 변환(QnaDTO, 다음페이지 번호)
		JSONObject jsonObject = new JSONObject();
    	jsonObject.put("nextPage",nextPage);
    	JSONArray jsonArray = new JSONArray();
    	for(int i=0;i<list.size();i++){
    		JSONObject temp = new JSONObject();
    		temp.put("title",list.get(i).getTitle());
    		temp.put("content",list.get(i).getContent());
    		temp.put("writer",list.get(i).getWriter());
    		temp.put("qdate",list.get(i).getQdate());
    		temp.put("status",list.get(i).getStatus());
    		temp.put("response",list.get(i).getResponse());
    		jsonArray.put(temp);
    	}
    	
    	jsonObject.put("result",jsonArray);
		//5. writer로 출력
		
		//6. 페이지이동 X이므로 view X
		return null;
	}

}
